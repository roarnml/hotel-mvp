generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//////////////////////
// USERS (STAFF)
//////////////////////

model User {
  id        String   @id @default(cuid())          // Internal staff/system user ID
  name      String                               // Staff full name
  email     String   @unique                      // Login email
  password  String                               // Hashed password
  role      Role     @default(STAFF)              // Authorization level
  isActive  Boolean  @default(true)               // Soft-disable staff access
  createdAt DateTime @default(now())              // Account creation time
  updatedAt DateTime @updatedAt                   // Auto-updated timestamp

  bookings  Booking[]                             // Bookings created by staff
}

//////////////////////
// GUESTS (CUSTOMERS)
//////////////////////

model Guest {
  id        String   @id @default(cuid())          // Guest unique identifier
  name      String                               // Guest full name
  email     String   @unique                      // Guest email (ticket delivery)
  phone     String?                              // Optional phone number
  address   String?                              // Optional address
  isVIP     Boolean  @default(false)              // VIP tagging
  createdAt DateTime @default(now())              // First appearance timestamp
  updatedAt DateTime @updatedAt                   // Profile updates

  bookings  Booking[]                             // All bookings made by guest
}

//////////////////////
// SUITES
//////////////////////

model Suite {
  id          String      @id @default(cuid())    // Suite unique ID
  name        String      @unique                 // Public-facing suite name
  description String                              // Suite description
  price       Int                                 // Base price per night (kobo)
  images      String[]                            // Image URLs
  isActive    Boolean     @default(true)          // Can be booked or not
  status      SuiteStatus @default(AVAILABLE)     // Operational status
  capacity    Int                                 // Max occupants
  features    String[]                            // Amenities list
  roomNumber  String      @default("UNASSIGNED")  // Physical room assignment

  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  bookings    Booking[]                           // Booking history
  seasonalRates SeasonalRate[]                    // Variable pricing
  housekeepingTasks HousekeepingTask[]            // Cleaning lifecycle
}

enum SuiteStatus {
  AVAILABLE
  OCCUPIED
  MAINTENANCE
}

//////////////////////
// BOOKINGS (CORE)
//////////////////////

model Booking {
  id            String        @id @default(cuid())   // Internal booking ID
  bookingRef    String        @unique                // Public booking reference
  suiteId       String                               // Linked suite
  guestId       String?                             // Linked guest
  userId        String?                              // Staff who created booking

  name          String                               // Guest name snapshot
  email         String                               // Guest email snapshot

  checkIn       DateTime                             // Check-in date
  checkOut      DateTime                             // Check-out date

  amountPaid    Int?                                 // Final amount paid (kobo)

  status        BookingStatus @default(PENDING)      // Booking lifecycle
  paymentStatus PaymentStatus @default(PENDING)      // Payment lifecycle

  ticketNumber  String?        @unique               // Human-friendly ticket ID
  checkInNumber String?        @unique               // Issued at arrival
  ticketPdfUrl  String?                              // Stored PDF location
  ticketIssuedAt DateTime?                           // When ticket was generated
  emailSentAt   DateTime?                            // When ticket email was sent

  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  suite         Suite         @relation(fields: [suiteId], references: [id])
  guest         Guest?         @relation(fields: [guestId], references: [id])
  user          User?         @relation(fields: [userId], references: [id])
  payment       Payment?                            // One-to-one payment

  @@index([suiteId, checkIn, checkOut])              // Availability checks
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CHECKED_IN
  CHECKED_OUT
  CANCELLED
}

//////////////////////
// PAYMENTS
//////////////////////

model Payment {
  id              String        @id @default(cuid()) // Internal payment ID
  bookingId       String        @unique               // One payment per booking

  amount          Int                                 // Amount charged (kobo)
  currency        String        @default("NGN")       // Currency code

  status          PaymentStatus @default(PENDING)    // Payment state
  provider        String        @default("PAYSTACK") // Payment provider

  paystackReference String     @unique               // Paystack transaction ref
  transactionId   String?       @unique              // Paystack transaction ID
  receiptUrl      String?                            // Paystack receipt
  webhookEventId  String?       @unique              // Idempotency guard

  paidAt          DateTime?                           // When payment succeeded

  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  booking         Booking       @relation(fields: [bookingId], references: [id])
}

enum PaymentStatus {
  PENDING
  SUCCESS
  FAILED
  REFUNDED
}

//////////////////////
// HOUSEKEEPING
//////////////////////

model Staff {
  id        String   @id @default(cuid())             // Staff ID
  name      String                                   // Staff name
  role      StaffRole                                // Operational role
  isActive  Boolean  @default(true)                  // Availability

  tasks     HousekeepingTask[]                       // Assigned tasks
}

model HousekeepingTask {
  id            String         @id @default(cuid())  // Task ID
  suiteId       String                                  
  assignedToId  String?

  status        CleaningStatus @default(PENDING)     // Cleaning state
  startedAt     DateTime?
  completedAt   DateTime?

  createdAt     DateTime       @default(now())

  suite         Suite          @relation(fields: [suiteId], references: [id])
  assignedTo    Staff?         @relation(fields: [assignedToId], references: [id])
}

enum CleaningStatus {
  PENDING
  IN_PROGRESS
  DONE
}

//////////////////////
// PRICING
//////////////////////

model SeasonalRate {
  id        String   @id @default(cuid())             // Rate ID
  suiteId  String                                   // Target suite
  start    DateTime                                 // Rate start
  end      DateTime                                 // Rate end
  price    Int                                      // Price override (kobo)
  label    String?                                  // e.g. "Christmas"

  suite    Suite @relation(fields: [suiteId], references: [id])
  createdAt DateTime @default(now())
}

//////////////////////
// ENUMS
//////////////////////

enum Role {
  SUPER_USER
  ADMIN
  STAFF
  HOUSEKEEPING
}

enum StaffRole {
  HOUSEKEEPING
  SUPERVISOR
  ADMIN
}
